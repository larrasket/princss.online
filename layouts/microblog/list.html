{{ define "styles" }}
<link rel="stylesheet" href="/styles/microblog.css" />
{{ end }} {{ define "main" }}
<img src="/media/images/microblog_header.png" />
<div class="header">
  <div class="left-header">
    <a href="/">vita nouva</a> /
    <a href="/microblog/" style="font-weight: bold">m-blog</a>
  </div>
  <div class="right-header">Warwick Castle, Jasper Francis Cropsey</div>
</div>
<div class="content">
  {{/* Build a slice with parsed org dates for proper sorting */}}
  {{ $posts := slice }}
  {{ range .Pages }}
    {{ $orgDate := partial "org-date.html" . }}
    {{ $posts = $posts | append (dict "page" . "orgDate" $orgDate) }}
  {{ end }}
  {{ $sortedPosts := sort $posts "orgDate" "desc" }}
  
  {{/* Get page size from config, default to 30, 0 = no pagination */}}
  {{ $pageSize := site.Params.microblogPageSize | default 30 }}
  
  {{/* Apply pagination if page size > 0 */}}
  {{ $paginatedPosts := $sortedPosts }}
  {{ $paginator := false }}
  {{ if gt $pageSize 0 }}
    {{ $pageObjects := slice }}
    {{ range $sortedPosts }}
      {{ $pageObjects = $pageObjects | append .page }}
    {{ end }}
    {{ $paginator = .Paginate $pageObjects $pageSize }}
    {{ $paginatedPosts = slice }}
    {{ range $paginator.Pages }}
      {{ $orgDate := partial "org-date.html" . }}
      {{ $paginatedPosts = $paginatedPosts | append (dict "page" . "orgDate" $orgDate) }}
    {{ end }}
    {{ $paginatedPosts = sort $paginatedPosts "orgDate" "desc" }}
  {{ end }}
  
  {{/* Display posts */}}
  {{ range $paginatedPosts }}
  {{ $page := .page }}
  <div class="post" id="{{ partial "org-param.html" (dict "page" $page "key" "post_id") }}">
    <div class="post-info">
      <img src="/media/images/pfp.png" style="width: 60px; height: 61px" />
      <div class="info">
        <div class="name">larrasket</div>
        <div class="date">{{ .orgDate.Format "02/01/06" }}</div>
        <div class="time">@{{ partial "org-date-time.html" $page }}</div>
      </div>
    </div>
    <div class="post-content">
      {{ partial "inject-permlink.html" (slice (partial "resolve-roam-links.html" (partial "strip-org-title.html" $page.Content)) $page.Permalink) }}
      {{ partial "extract-backlinks.html" $page }}
    </div>
  </div>
  {{ end }}
  
  {{/* Pagination navigation */}}
  {{ if $paginator }}
    {{ partial "pagination.html" $paginator }}
  {{ end }}
</div>
{{ end }} {{ define "scripts" }}
<script>
  document.querySelectorAll(".copy-permalink").forEach((el) => {
    el.addEventListener("click", async (e) => {
      e.preventDefault();
      const url = el.dataset.url;
      try {
        await navigator.clipboard.writeText(url);
        const original = el.textContent;
        el.textContent = "[copied]";
        setTimeout(() => (el.textContent = original), 1500);
      } catch (err) {
        console.error("Failed to copy:", err);
      }
    });
  });
</script>
{{ end }}
