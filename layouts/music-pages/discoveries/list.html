<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ .Title }}</title>
  <link rel="stylesheet" href="/styles/style.css">
  <link rel="stylesheet" href="/styles/music_page.css">
</head>
<body>
  <div class="page-header">discoveries</div>
  <div class="content">
    <p>{{ .Description }}</p>
    <div class="discoveries">
      {{ $pages := .Pages.ByDate.Reverse }}
      {{ range $i, $p := $pages }}
      <div class="discovery"{{ if eq $i (sub (len $pages) 1) }} style="border-bottom: none;"{{ end }}>
        <div class="discovery-left">
          <img src="{{ partial "org-param.html" (dict "page" $p "key" "image") }}">
          <div class="discovery-info">
            <div class="artist">{{ partial "org-param.html" (dict "page" $p "key" "artist") }}</div>
            <div class="title">{{ partial "org-param.html" (dict "page" $p "key" "title") }}</div>
          </div>
        </div>
        <div class="discovery-right">
          {{ partial "resolve-roam-links.html" (partial "strip-org-title.html" $p.Content) }}<a
            class="copy-permalink"
            data-url="{{ $p.Permalink }}"
            title="Copy permalink"
            >[permlink]</a>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
  <script>
    document.querySelectorAll(".copy-permalink").forEach((el) => {
      el.addEventListener("click", async (e) => {
        e.preventDefault();
        const url = el.dataset.url;
        try {
          await navigator.clipboard.writeText(url);
          const original = el.textContent;
          el.textContent = "[copied]";
          setTimeout(() => (el.textContent = original), 1500);
        } catch (err) {
          console.error("Failed to copy:", err);
        }
      });
    });
  </script>
</body>
</html>
