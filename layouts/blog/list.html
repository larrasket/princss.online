{{ define "styles" }}
<link rel="stylesheet" href="/styles/blog.css" />
{{ end }} {{ define "main" }} {{/* Generate consistent artwork index using md5
*/}} {{ $artFiles := readDir "static/images/art" }} {{ $artCount := len
$artFiles }} {{ $hash := md5 .RelPermalink }} {{ $hashNum := 0 }} {{ range $i,
$c := (slice (substr $hash 0 1) (substr $hash 1 1) (substr $hash 2 1)) }} {{ if
eq $c "a" }}{{ $hashNum = add $hashNum 10 }} {{ else if eq $c "b" }}{{ $hashNum
= add $hashNum 11 }} {{ else if eq $c "c" }}{{ $hashNum = add $hashNum 12 }} {{
else if eq $c "d" }}{{ $hashNum = add $hashNum 13 }} {{ else if eq $c "e" }}{{
$hashNum = add $hashNum 14 }} {{ else if eq $c "f" }}{{ $hashNum = add $hashNum
15 }} {{ else }}{{ $hashNum = add $hashNum (int $c) }} {{ end }} {{ end }} {{
$artIndex := mod $hashNum $artCount }} {{ $artFile := index $artFiles $artIndex
}}

<div class="blog-layout">
  <div class="blog-content">
    <nav class="breadcrumb">
      <a href="/">home</a> <span class="sep">→</span> {{ if in .File.Dir "t/"
      }}<a href="/blog/">blog</a> <span class="sep">→</span> topics{{ else
      }}blog{{ end }}
    </nav>

    <main>
      {{ if in .File.Dir "t/" }}
      <h1 class="page-title">Topics</h1>
      <div class="topics-list">
        {{ range .Pages }} {{ $title := partial "org-title.html" . }} {{ if
        $title }}
        <a href="{{ .RelPermalink }}" class="topic-link">{{ $title }}</a>
        {{ end }} {{ end }}
      </div>

      {{ else }}
      <h1 class="page-title">Blog</h1>

      {{- $allPages := slice -}} {{- range (.Site.GetPage
      "/blog").RegularPagesRecursive -}} {{- if in .File.Dir "p/" -}} {{ $date
      := partial "org-date.html" . }} {{ $allPages = $allPages | append (dict
      "page" . "date" $date) }} {{- end -}} {{- end -}} {{- $allPages = sort
      $allPages "date" "desc" -}}

      <div class="posts-list">
        {{ range $allPages }} {{ $title := partial "org-title.html" .page }} {{
        if $title }}
        <article class="post-entry">
          <span class="date">{{ .date.Format "Jan 2, 2006" }}</span>
          <a href="{{ .page.RelPermalink }}">{{ $title }}</a>
        </article>
        {{ end }} {{ end }}
      </div>

      {{/* Topics section - sorted by post count */}} {{ $topicsWithCount :=
      slice }} {{ $topics := (.Site.GetPage "/blog/t").Pages }} {{ range $topic
      := $topics }} {{ $title := partial "org-title.html" $topic }} {{ if $title
      }} {{/* Get topic ID */}} {{ $topicId := "" }} {{ $rawContent :=
      $topic.RawContent }} {{ $idMatch := findRE `:ID:\s+(\S+)` $rawContent 1 }}
      {{ if $idMatch }} {{ $idLine := index $idMatch 0 }} {{ $topicId =
      replaceRE `:ID:\s+` "" $idLine }} {{ end }} {{/* Count pages that
      reference this topic */}} {{ $count := 0 }} {{ if $topicId }} {{ range
      site.AllPages }} {{ if and .File (eq .File.Ext "org") }} {{ if not (in
      .File.Dir "t/") }} {{ if in .RawContent $topicId }} {{ $count = add $count
      1 }} {{ end }} {{ end }} {{ end }} {{ end }} {{ end }} {{ $topicsWithCount
      = $topicsWithCount | append (dict "topic" $topic "title" $title "count"
      $count) }} {{ end }} {{ end }} {{/* Sort by count descending */}} {{
      $topicsWithCount = sort $topicsWithCount "count" "desc" }}
      <div class="topics-footer">
        <span class="topics-header">Tags:</span>
        {{ range $i, $t := $topicsWithCount }}<a
          href="{{ $t.topic.RelPermalink }}"
          >{{ $t.title }}</a
        >{{ if lt $i (sub (len $topicsWithCount) 1) }} / {{ end }}{{ end }}
      </div>

      {{ end }}
    </main>
  </div>

  <div class="separator"></div>

  <div class="blog-artwork">
    <div class="artwork-box">
      <img src="/images/art/{{ $artFile.Name }}" alt="Artwork" loading="lazy" />
      <div class="artwork-note">
        This is an arbitrary picked image, hashed internally and mapped to this
        page. You will have to see it as long as you in my website. hash: {{
        substr $hash 0 8 }}… → idx {{ $artIndex }}/{{ $artCount }}
      </div>
    </div>
  </div>
</div>
{{ end }}
