{{ define "styles" }}
<link rel="stylesheet" href="/styles/films.css" />
{{ end }} {{ define "main" }}
<div class="body-div">
  <img src="/media/images/films_header.png" />
  <div class="header" style="position: sticky; top: 0px">
    <div class="left-header">
      <a href="/">vita nouva</a> /
      <a href="/films/" style="font-weight: bold">films</a> /
      <a href="https://letterboxd.com/lr0/">letterboxd</a>
    </div>
    <div class="right-header">
      Shakespeare's Globe Theater (1886-88) "Fresco" [Burgtheater, Vienna,
      Austria]
    </div>
  </div>
  <div class="content">
    {{/* Get page size from config, default to 10, 0 = no pagination */}}
    {{ $pageSize := site.Params.filmsPageSize | default 10 }}
    
    {{/* Build sorted pages using org-date for proper date parsing - SORT FIRST */}}
    {{ $allSorted := slice }}
    {{ range .Pages }}
      {{ $orgDate := partial "org-date.html" . }}
      {{ $allSorted = $allSorted | append (dict "page" . "orgDate" $orgDate) }}
    {{ end }}
    {{ $allSorted = sort $allSorted "orgDate" "desc" }}
    
    {{/* Manual pagination - Hugo's .Paginate reorders pages */}}
    {{ $pageNum := 1 }}
    {{ with .Paginator }}
      {{ $pageNum = .PageNumber }}
    {{ end }}
    {{ $totalItems := len $allSorted }}
    {{ $startIdx := mul (sub $pageNum 1) $pageSize }}
    {{ $endIdx := add $startIdx $pageSize }}
    {{ if gt $endIdx $totalItems }}
      {{ $endIdx = $totalItems }}
    {{ end }}
    
    {{/* Slice the sorted pages for current page */}}
    {{ $sortedPages := slice }}
    {{ if eq $pageSize 0 }}
      {{ $sortedPages = $allSorted }}
    {{ else }}
      {{ range $i, $item := $allSorted }}
        {{ if and (ge $i $startIdx) (lt $i $endIdx) }}
          {{ $sortedPages = $sortedPages | append $item }}
        {{ end }}
      {{ end }}
    {{ end }}
    
    {{/* Still need paginator for pagination nav */}}
    {{ $paginator := false }}
    {{ if gt $pageSize 0 }}
      {{ $paginator = .Paginate .Pages $pageSize }}
    {{ end }}
    
    {{ range $sortedPages }}
    {{ $film := .page }}
    <div class="film">
      <div class="left">
        <div class="frame">
          <img src="{{ partial "org-param.html" (dict "page" $film "key" "image")
          }}" style="z-index: 1;">
        </div>
        <div class="info">
          <div class="title">
            {{ partial "org-param.html" (dict "page" $film "key" "title") }}
          </div>
          <div class="genre">
            {{ partial "org-param.html" (dict "page" $film "key" "genre") }}
          </div>
          <div class="director">
            dir. {{ partial "org-param.html" (dict "page" $film "key" "director") }}
          </div>
        </div>
      </div>
      <div class="right">
        {{ partial "resolve-roam-links.html" $film.Content }}<a
          class="copy-permalink"
          data-url="{{ $film.Permalink }}"
          title="Copy permalink"
          >[permlink]</a
        >
        {{ partial "native-backlinks.html" $film }}
      </div>
    </div>
    {{ end }}
    
    {{/* Pagination navigation */}}
    {{ if $paginator }}
      {{ partial "pagination.html" $paginator }}
    {{ end }}
  </div>
</div>
{{ end }} {{ define "scripts" }}
<script>
  document.querySelectorAll(".copy-permalink").forEach((el) => {
    el.addEventListener("click", async (e) => {
      e.preventDefault();
      const url = el.dataset.url;
      try {
        await navigator.clipboard.writeText(url);
        const original = el.textContent;
        el.textContent = "[copied]";
        setTimeout(() => (el.textContent = original), 1500);
      } catch (err) {
        console.error("Failed to copy:", err);
      }
    });
  });
</script>
{{ end }}
