{{ define "styles" }}
<link rel="stylesheet" href="/styles/index_v2.css" />
<link rel="stylesheet" href="/styles/calendar.css" />
<link rel="stylesheet" href="/styles/audio_player.css" />
{{ end }} {{ define "bodyAttrs" }} onload="startTime()"{{ end }} {{ define
"main" }}
<img
  src="/media/images/princss_header_2.png"
  class="header-image"
  style="margin: auto; display: block"
/>
<div class="header">
  <div class="left-header">
    <span style="font-weight: bold">vita nouva</span>
  </div>
  <div class="hamburger" onclick="toggleNav()">☰ menu</div>
  <div class="right-header" id="mainNav">
    <div class="nav-link">
      <a href="/diary/" class="link">diary</a>
    </div>
    <div class="nav-link">
      <a href="/microblog/" class="link">microblog</a>
    </div>
    <div class="nav-link">
      <a href="/films/" class="link">films</a>
    </div>
    <div class="nav-link">
      <a href="/music/" class="link">music</a>
    </div>
    <div class="nav-link">
      <a href="/pic-log/" class="link">pic log</a>
    </div>

    <div class="nav-link">
      <a href="/exhibition/" class="link">exhib.</a>
    </div>

    <div class="nav-link">
      <a href="/~saleh/" class="link">blog</a>
    </div>

    <div class="nav-link">
      <a href="/~saleh/a.html" class="link">anth.</a>
    </div>

    <div class="nav-link" style="border-right: none">
      <a href="mailto:root@lr0.org?subject=Hello" class="link">email</a>
    </div>
  </div>
</div>
<div class="content">
  <div class="left">
    <div class="mobile-widgets-row">
      <!-- Row 1: Featured image + Calendar (side by side on mobile) -->
      <!-- Mobile-only featured image -->
      {{ $piclog := where .Site.RegularPages "Section" "pic-log" }} {{ $lastPic
      := index (sort $piclog ".Date" "desc") 0 }}
      <div class="mobile-widget mobile-featured-widget">
        <div class="name-header">featured img</div>
        <div class="featured-image">
          <a href="/pic-log/">
            <img src="{{ $lastPic.Params.image }}" />
          </a>
        </div>
      </div>

      <div class="mobile-widget calendar-widget">
        <div id="calendar"></div>
        <div class="calendar-buttons">
          <button
            id="prev"
            type="button"
            style="border-right: none; text-align: right; border-left: none"
          >
            ←
          </button>
          <button
            id="next"
            type="button"
            style="border-right: none; text-align: left"
          >
            →
          </button>
        </div>
      </div>

      <!-- Row 2: Buttons (full width on mobile) -->
      <div class="neighbors-widget">
        <!-- Neighbors -->
        <div class="neighbors">
          <div class="neighbors-title">buttons and propaganda</div>
          <div class="neighbors-buttons">{{ partial "neighbors.html" . }}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="right">
    <div class="main-content">
      <div class="main-content-left">
        <img src="/media/images/welcome.png" />
        <div class="welcome">{{ .Content }}</div>
        <img src="/media/images/royaldecree.png" />
        <div class="updates">
          <iframe src="/updates/" name="updates_frame"></iframe>
        </div>
      </div>
      <div class="main-content-right">
        <div class="about">
          <div class="name-header">lr0</div>
          <img src="/media/images/about_pfp.png" />
          <div class="about-desc">^ Existentialist at heart.</div>
          <div id="github-activity">
            <div id="github-username">
              <a href="https://github.com/larrasket" target="_blank"
                >gh: @larrasket</a
              >
            </div>
            <div id="github-content">loading...</div>
          </div>
          <div class="about-statuses">
            <div class="about-statuses-title">what am i doing?</div>
            <div class="about-status">
              <img src="/media/images/watching_emoji.png" /> Sergei Parajanov
            </div>
            <div class="about-status">
              <img src="/media/images/book_emoji.png" /> Spinoza
            </div>
            <div class="about-status">
              <img src="/media/images/thinking_emoji.png" /> Arabic NLP
            </div>
            <div class="about-status">
              <img src="/media/images/writing_emoji.png" /> Notes on poetry
            </div>
          </div>
          <audio controls style="display: none" id="main-audio">
            <source src="" type="audio/mp3" />
          </audio>
          <div class="audio-player">
            <div class="timeline">
              <div class="progress"></div>
            </div>
            <div class="controls">
              <div class="play-container">
                <div class="toggle-play play"></div>
              </div>
              <div class="time">
                <div class="current">0:00</div>
                <div class="divider">/</div>
                <div class="length"></div>
              </div>
              <div class="name">
                <marquee scrollamount="2" id="song-title">Loading...</marquee>
              </div>
              <div class="volume-container">
                <div class="volume-button">
                  <div class="volume icono-volumeMedium"></div>
                </div>
                <div class="volume-slider">
                  <div class="volume-percentage"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- Featured Image - dynamically get last pic-log entry -->
          {{ $piclog := where .Site.RegularPages "Section" "pic-log" }} {{
          $lastPic := index (sort $piclog ".Date" "desc") 0 }}
          <div class="name-header">featured img</div>
          <div class="featured-image">
            <a href="/pic-log/">
              <img src="{{ $lastPic.Params.image }}" />
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="footer">
  <div class="footer-left"></div>
  <div class="footer-middle" style="text-align: center"></div>
  <div class="footer-right" style="text-align: right">c. lr0 2025</div>
</div>
{{ end }} {{ define "scripts" }}
<script>
  function startTime() {
    const today = new Date();
    let h = today.getHours();
    let m = today.getMinutes();
    let s = today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    const txtEl = document.getElementById("txt");
    if (txtEl) txtEl.innerHTML = h + ":" + m + ":" + s;
    setTimeout(startTime, 1000);
  }
  function checkTime(i) {
    if (i < 10) {
      i = "0" + i;
    }
    return i;
  }
</script>
<script>
  const songs = [
    {
      file: "Caress (feat. Bachar Khalife, Rami Khalife & Peter Herbert).mp3",
      title: "Caress",
      artist: "Bachar Khalife, Rami Khalife & Peter Herbert",
    },
    {
      file: "Chopin Etude Op 25  No.11 Valentina Lisitsa.mp3",
      title: "Etude Op. 25 No. 11",
      artist: "Chopin (Valentina Lisitsa)",
    },
    {
      file: "Dust Flesh and Bones.mp3",
      title: "Dust Flesh and Bones",
      artist: "Matt Elliot",
    },
    {
      file: "Hamilu'l Hawa.mp3",
      title: "Hamilu'l Hawa",
      artist: "Ghada Ghanem",
    },
    {
      file: "Hungarian Rhapsody No. 2 in C-Sharp Minor.mp3",
      title: "Hungarian Rhapsody No. 2",
      artist: "Franz Liszt",
    },
    {
      file: "K. 183 Mozart Symphony No. 25 in G minor, I Allegro con brio.mp3",
      title: "Symphony No. 25 - Allegro con brio",
      artist: "Mozart",
    },
    {
      file: "La Campanella - Adam Gyorgy (2007).mp3",
      title: "La Campanella",
      artist: "Liszt (Adam Gyorgy)",
    },
    { file: "Salento.mp3", title: "Salento", artist: "René Aubry" },
    {
      file: "Serenade for String Orchestra in E major, Op. 22 - Tempo di Valse.mp3",
      title: "Serenade Op. 22 - Tempo di Valse",
      artist: "Dvořák",
    },
    {
      file: "Shostakovich： Jazz Suite No. 2： VI. Waltz II.mp3",
      title: "Jazz Suite No. 2: Waltz II",
      artist: "Shostakovich",
    },
  ];

  const randomSong = songs[Math.floor(Math.random() * songs.length)];

  // Update the song title display
  document.getElementById("song-title").textContent =
    randomSong.artist + " - " + randomSong.title;

  const audioPlayer = document.querySelector(".audio-player");
  const audio = new Audio(
    "/media/audio/" + encodeURIComponent(randomSong.file),
  );

  audio.addEventListener(
    "loadeddata",
    () => {
      audioPlayer.querySelector(".time .length").textContent =
        getTimeCodeFromNum(audio.duration);
      audio.volume = 1;
    },
    false,
  );

  const timeline = audioPlayer.querySelector(".timeline");
  timeline.addEventListener(
    "click",
    (e) => {
      const timelineWidth = window.getComputedStyle(timeline).width;
      const timeToSeek = (e.offsetX / parseInt(timelineWidth)) * audio.duration;
      audio.currentTime = timeToSeek;
    },
    false,
  );

  const volumeSlider = audioPlayer.querySelector(".controls .volume-slider");
  volumeSlider.addEventListener(
    "click",
    (e) => {
      const sliderWidth = window.getComputedStyle(volumeSlider).width;
      const newVolume = e.offsetX / parseInt(sliderWidth);
      audio.volume = newVolume;
      audioPlayer.querySelector(".controls .volume-percentage").style.width =
        newVolume * 100 + "%";
    },
    false,
  );

  setInterval(() => {
    const progressBar = audioPlayer.querySelector(".progress");
    progressBar.style.width = (audio.currentTime / audio.duration) * 100 + "%";
    audioPlayer.querySelector(".time .current").textContent =
      getTimeCodeFromNum(audio.currentTime);
  }, 500);

  const playBtn = audioPlayer.querySelector(".controls .toggle-play");
  playBtn.addEventListener(
    "click",
    () => {
      if (audio.paused) {
        playBtn.classList.remove("play");
        playBtn.classList.add("pause");
        audio.play();
      } else {
        playBtn.classList.remove("pause");
        playBtn.classList.add("play");
        audio.pause();
      }
    },
    false,
  );

  audioPlayer.querySelector(".volume-button").addEventListener("click", () => {
    const volumeEl = audioPlayer.querySelector(".volume-container .volume");
    audio.muted = !audio.muted;
    if (audio.muted) {
      volumeEl.classList.remove("icono-volumeMedium");
      volumeEl.classList.add("icono-volumeMute");
    } else {
      volumeEl.classList.add("icono-volumeMedium");
      volumeEl.classList.remove("icono-volumeMute");
    }
  });

  function getTimeCodeFromNum(num) {
    let seconds = parseInt(num);
    let minutes = parseInt(seconds / 60);
    seconds -= minutes * 60;
    const hours = parseInt(minutes / 60);
    minutes -= hours * 60;
    if (hours === 0) return `${minutes}:${String(seconds % 60).padStart(2, 0)}`;
    return `${String(hours).padStart(2, 0)}:${minutes}:${String(
      seconds % 60,
    ).padStart(2, 0)}`;
  }
</script>
<script>
  (async function () {
    const username = "larrasket";
    const container = document.getElementById("github-content");
    try {
      const res = await fetch(
        `https://api.github.com/users/${username}/events/public?per_page=5`,
      );
      const events = await res.json();
      if (events.length === 0) {
        container.textContent = "No recent activity";
        return;
      }
      // Find the most recent push event
      const pushEvent = events.find((e) => e.type === "PushEvent");
      if (pushEvent) {
        const repo = pushEvent.repo.name.split("/")[1];
        const commit = pushEvent.payload.commits?.[0];
        const msg = commit ? commit.message.split("\n")[0] : "committed";
        const time = new Date(pushEvent.created_at);
        const ago = getTimeAgo(time);
        container.innerHTML = `<span class="github-emoji">code:</span> ${ago}: <em>${msg.substring(
          0,
          40,
        )}${msg.length > 40 ? "..." : ""}</em> @ <a href="https://github.com/${
          pushEvent.repo.name
        }" target="_blank">${repo}</a>`;
      } else {
        const event = events[0];
        const repo = event.repo.name.split("/")[1];
        const time = new Date(event.created_at);
        const ago = getTimeAgo(time);
        container.innerHTML = `<span class="github-emoji">⭐</span> ${ago}: activity on <a href="https://github.com/${event.repo.name}" target="_blank">${repo}</a>`;
      }
    } catch (e) {
      container.textContent = "Could not load activity";
    }
    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      if (seconds < 60) return "just now";
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `${minutes}m ago`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}h ago`;
      const days = Math.floor(hours / 24);
      if (days < 30) return `${days}d ago`;
      return `${Math.floor(days / 30)}mo ago`;
    }
  })();
</script>
<script>
  const weeks = ["S", "M", "T", "W", "T", "F", "S"];
  const holidays = [];
  const holidaysDate = holidays.map((holiday) => new Date(holiday));
  const config = { displayMonthNumber: 1 };

  const date = new Date();
  let year = date.getFullYear();
  let month = date.getMonth() + 1;

  function showCalendar(year, month) {
    month = month;
    if (month < 1) {
      year--;
      month = 2;
    }
    for (let i = 0; i < config.displayMonthNumber; i++) {
      const calendarHtml = createCalendar(year, month);
      const sec = document.createElement("section");
      sec.innerHTML = calendarHtml;
      document.querySelector("#calendar").appendChild(sec);
      month++;
      if (month > 12) {
        year++;
        month = 1;
      }
    }
  }

  function createCalendar(year, month) {
    const startDate = new Date(year, month - 1, 1);
    const endDate = new Date(year, month, 0);
    const endDayCount = endDate.getDate();
    const lastMonthEndDate = new Date(year, month - 1, 0);
    const lastMonthEndDayCount = lastMonthEndDate.getDate();
    const startDay = startDate.getDay();
    let dayCount = 1;
    let calendarHtml = "";

    calendarHtml += "<h1>" + month + " / " + year + "</h1>";
    calendarHtml += "<table>";

    for (let i = 0; i < weeks.length; i++) {
      calendarHtml += "<td>" + weeks[i] + "</td>";
    }

    for (let w = 0; w < 6; w++) {
      calendarHtml += "<tr>";
      for (let d = 0; d < 7; d++) {
        if (w == 0 && d < startDay) {
          let num = lastMonthEndDayCount - startDay + d + 1;
          calendarHtml += '<td class="is-disabled">' + num + "</td>";
        } else if (dayCount > endDayCount) {
          let num = dayCount - endDayCount;
          calendarHtml += '<td class="is-disabled">' + num + "</td>";
          dayCount++;
        } else {
          let cssClass = "";
          if (date.getMonth() == month - 1 && date.getDate() == dayCount) {
            cssClass += "today";
          }
          if (isHoliday(year, month - 1, dayCount)) {
            cssClass += " holiday";
          }
          calendarHtml += `<td class="${cssClass}">${dayCount}</td>`;
          dayCount++;
        }
      }
      calendarHtml += "</tr>";
    }
    calendarHtml += "</table>";
    return calendarHtml;
  }

  function isHoliday(year, month, day) {
    return holidaysDate.some((holiday) => {
      return (
        holiday.getFullYear() == year &&
        holiday.getMonth() == month &&
        holiday.getDate() == day
      );
    });
  }

  function moveCalendar(e) {
    document.querySelector("#calendar").innerHTML = "";
    if (e.target.id === "prev") {
      month--;
      if (month < 1) {
        year--;
        month = 12;
      }
    }
    if (e.target.id === "next") {
      month++;
      if (month > 12) {
        year++;
        month = 1;
      }
    }
    showCalendar(year, month);
  }

  document.querySelector("#prev").addEventListener("click", moveCalendar);
  document.querySelector("#next").addEventListener("click", moveCalendar);
  showCalendar(year, month);

  // Hamburger menu toggle
  function toggleNav() {
    const nav = document.getElementById("mainNav");
    nav.classList.toggle("nav-open");
  }

  // Close nav menu on scroll (but keep hamburger visible)
  const hamburger = document.querySelector(".hamburger");
  const nav = document.getElementById("mainNav");

  window.addEventListener(
    "scroll",
    function () {
      if (window.innerWidth <= 480) {
        // Just close the nav menu on scroll, keep hamburger visible
        nav.classList.remove("nav-open");
      }
    },
    false,
  );
</script>
{{ end }}
